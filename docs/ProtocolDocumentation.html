<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ProtocolDocumentation">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Protocol Documentation | Vortex</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://lnvortex.com/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://lnvortex.com/img/logo.svg"><meta data-rh="true" property="og:url" content="https://lnvortex.com/docs/ProtocolDocumentation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:site" content="@run_vortex"><meta data-rh="true" name="twitter:creator" content="@run_vortex"><meta data-rh="true" name="og:url" content="https://lnvortex.com"><meta data-rh="true" name="og:title" content="Vortex"><meta data-rh="true" name="og:description" content="Lightning and Taproot enabled collaborative transactions"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Protocol Documentation | Vortex"><meta data-rh="true" name="description" content="This is an adaptation of ZeroLink made to be usable for"><meta data-rh="true" property="og:description" content="This is an adaptation of ZeroLink made to be usable for"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lnvortex.com/docs/ProtocolDocumentation"><link data-rh="true" rel="alternate" href="https://lnvortex.com/docs/ProtocolDocumentation" hreflang="en"><link data-rh="true" rel="alternate" href="https://lnvortex.com/docs/ProtocolDocumentation" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Vortex RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Vortex Atom Feed">



<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><link rel="stylesheet" href="/assets/css/styles.784f2811.css">
<link rel="preload" href="/assets/js/runtime~main.54e95d92.js" as="script">
<link rel="preload" href="/assets/js/main.3a715e8a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/vortex-light-mode.svg" alt="Vortex logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/vortex-dark-mode.svg" alt="Vortex logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/quick-start">Documentation</a><a href="https://github.com/ln-vortex/ln-vortex/releases/latest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Download</a><a href="https://github.com/ln-vortex/ln-vortex" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quick-start">Quick Start Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/verifying-binaries">Verifying Binaries</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Backends">Backends</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backends&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/rpc-docs">RPC Docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/voltage">Setting up with Voltage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/ProtocolDocumentation">Protocol Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/asyncapi">Vortex API 1.0.0 documentation</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Protocol Documentation</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Protocol Documentation</h1><p>This is an adaptation of <a href="https://github.com/nopara73/ZeroLink/blob/master/README.md" target="_blank" rel="noopener noreferrer">ZeroLink</a> made to be usable for
opening lightning channels.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="considerations">Considerations<a class="hash-link" href="#considerations" title="Direct link to heading">​</a></h2><p>We could not directly use the ZeroLink framework for opening lightning channels because when opening a lightning channel
we have only 10 minutes to broadcast the funding transaction from when we negotiate the channel with our channel peer.
Unless we have coinjoin rounds every 10 minutes this is not possible under the initial ZeroLink spec because the blinded
output must be given during the input registration phase, and we can&#x27;t know the output until we negotiate with the
channel peer.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="protocol">Protocol<a class="hash-link" href="#protocol" title="Direct link to heading">​</a></h2><p>See <a target="_blank" href="/assets/files/detailed-protocol-90fa8f4e9235e3e4717a27135bc971c9.jpeg">detailed-protocol.jpeg</a> for a visualization of the protocol.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-pending--queueing-phase">1. Pending &amp; Queueing Phase<a class="hash-link" href="#1-pending--queueing-phase" title="Direct link to heading">​</a></h4><p>Many Alices queue for the next CoinJoin by sending an <code>AskNonce</code> message, prompting the coordinator to generate a unique
nonce for Alice that will later be used in the blind signature.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-input-registration">2. Input Registration<a class="hash-link" href="#2-input-registration" title="Direct link to heading">​</a></h4><p>The coordinator sends an <code>AskInputs</code> message to every Alice that asked for a nonce which then prompts the beginning of
the Input Registration phase.</p><p>Many Alices begin channel negotiation with their peer, then register to the coordinator:</p><ul><li>confirmed utxos as the inputs of the CoinJoin</li><li>proofs - a signed witness script of a transaction that commits to their unique nonce</li><li>their change address</li><li>the blinded output</li></ul><p>Coordinator checks if inputs have enough coins, are unspent, confirmed, were not registered twice and that the provided
proofs are valid, and change address is of the correct type, then signs the blinded output. Alices unblind their signed
and blinded outputs.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-output-registration">3. Output Registration<a class="hash-link" href="#3-output-registration" title="Direct link to heading">​</a></h4><p>Alice under a new tor identity as Bob sends the unblinded signature with the output to the coordinator.</p><p>Coordinator verifies the signature is valid and the output address is of the correct type.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-signing-phase">4. Signing Phase<a class="hash-link" href="#4-signing-phase" title="Direct link to heading">​</a></h4><p>Coordinator builds the unsigned CoinJoin transaction and gives it to Alices for signing. Alices sign and notify their
channel peer of the funding transaction for their channel. When all the Alices signatures arrive, the coordinator
combines the signatures and propagates the CoinJoin on the network, and sends it to the Alices.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privacy-considerations">Privacy Considerations<a class="hash-link" href="#privacy-considerations" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dealing-with-change">Dealing with change<a class="hash-link" href="#dealing-with-change" title="Direct link to heading">​</a></h3><p>The goal of this CoinJoin is to open a lightning channel without having to reveal which utxos are yours. Because of
this, it is important to preserve privacy after the round, specifically with the change output(s).</p><p>Since the users are not mixing to themselves and instead directly into a lightning channel, we must consider the
implications of how easily inputs and change can be linked. For example, if two users are mixing to open a 1 BTC channel
each, and user A registers with a 10 BTC input and user B registers with a 2 BTC output, it will be very obvious whose
change output is whose. Later if this change output is spent in another transaction related to their lightning node they
could easily reveal which inputs were theirs in the CoinJoin transaction. This will be known as the change problem.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mixing-change-outputs-in-the-coinjoin">Mixing change outputs in the CoinJoin<a class="hash-link" href="#mixing-change-outputs-in-the-coinjoin" title="Direct link to heading">​</a></h4><p>A potential solution to the change problem is mixing the change outputs in the coinjoin transaction. This can be done by
splitting the change into many outputs of the same denomination and then having a single extra change is the leftover
from the all the equal amount outputs. Doing this will make it so the user receives many change outputs back and these
will be of the size where the user will not need a change output for the following round. This however will require
substantial changes to the protocol. Alice will instead need to register many blinded outputs all under different Bob
identities.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="allowing-only-mixed-inputs">Allowing only mixed inputs<a class="hash-link" href="#allowing-only-mixed-inputs" title="Direct link to heading">​</a></h4><p>Another potential solution to the change problem is having a separate CoinJoin round that mixes coins back to the user
themselves, then enforcing that the inputs for the lightning round must come from a mix. This way there would be no
change outputs in the opening of the lightning channel and thus harder to link to a single lightning node. The tradeoff
here is that it is more expensive for the user and on-chain, it requires multiple transactions and the user will need to
pay coordinator fees multiple times likely. This does come with an added benefit of allowing the users to be able to mix
their coins many times before opening the channel to give themselves potentially better privacy guarantees.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ln-vortex/ln-vortex/docs/ProtocolDocumentation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/voltage"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Setting up with Voltage</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/asyncapi"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Vortex API 1.0.0 documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#considerations" class="table-of-contents__link toc-highlight">Considerations</a></li><li><a href="#protocol" class="table-of-contents__link toc-highlight">Protocol</a></li><li><a href="#privacy-considerations" class="table-of-contents__link toc-highlight">Privacy Considerations</a><ul><li><a href="#dealing-with-change" class="table-of-contents__link toc-highlight">Dealing with change</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/run_vortex" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://matrix.to/#/#ln-vortex:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix</a></li><li class="footer__item"><a href="https://github.com/ln-vortex/ln-vortex" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.54e95d92.js"></script>
<script src="/assets/js/main.3a715e8a.js"></script>
</body>
</html>